<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard | Rotary Tamirabarani</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="admin-css/admin-dashboard.css">
</head>
<body>
  <div class="admin-container">
    <!-- Sidebar Navigation -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <img src="https://ui-avatars.com/api/?name=Rotary+Admin&background=4361ee&color=fff" alt="Admin">
        <h2>Rotary Admin</h2>
      </div>
      
      <ul class="nav-menu">
        <li class="nav-item">
          <a href="#" class="nav-link active">
            <i class="fas fa-tachometer-alt"></i>
            <span>Dashboard</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="admin-registrationlist.html" class="nav-link">
            <i class="fas fa-users"></i>
            <span>Registrations</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="admin-events.html" class="nav-link">
            <i class="fas fa-calendar-alt"></i>
            <span>Events</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="image_upload.html" class="nav-link">
            <i class="fas fa-images"></i>
            <span>Media Gallery</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="create-user.html" class="nav-link">
            <i class="fas fa-user-cog"></i>
            <span>User Management</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="admin-video.html" class="nav-link">
            <i class="fas fa-video"></i>
            <span>YouTube</span>
          </a>
        </li>
        <!-- <li class="nav-item">
          <a href="#" class="nav-link">
            <i class="fas fa-cog"></i>
            <span>Settings</span>
          </a>
        </li> -->
      </ul>
      
      <button class="btn btn-outline" style="width: 100%;" onclick="logout()">
        <i class="fas fa-sign-out-alt"></i> Logout
      </button>
    </aside>

    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Main Content -->
    <main class="main-content">
      <div class="header">
        <button class="mobile-menu-btn" id="mobileMenuBtn">
          <i class="fas fa-bars"></i>
        </button>
        <h1><i class="fas fa-tachometer-alt"></i> Dashboard</h1>
       <div class="user-info" id="userProfile">
  <img id="userAvatar" src="" alt="User">
  <span id="userRoleDisplay"></span>
</div>

      </div>
      
      <!-- Stats Cards -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-title">Total Events</div>
            <div class="stat-icon">
              <i class="fas fa-calendar"></i>
            </div>
          </div>
          <div class="stat-value">24</div>
          <div class="stat-footer">
            <i class="fas fa-arrow-up"></i> 5% from last month
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-title">Total Registrations</div>
            <div class="stat-icon">
              <i class="fas fa-users"></i>          
            </div>
          </div>
          <div class="stat-value">1,248</div>
          <div class="stat-footer">
            <i class="fas fa-arrow-up"></i> 12% from last month
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-title">Upcoming Events</div>
            <div class="stat-icon">
              <i class="fas fa-clock"></i>
            </div>
          </div>
          <div class="stat-value">3</div>
          <div class="stat-footer">
            Next event in 5 days
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-title">Gallery Images</div>
            <div class="stat-icon">
              <i class="fas fa-image"></i>
            </div>
          </div>
          <div class="stat-value">86</div>
          <div class="stat-footer">
            <i class="fas fa-arrow-up"></i> 8 new this week
          </div>
        </div>
      </div>
      
      <!-- Quick Actions -->
      <div class="quick-actions">
        <h2 class="section-title">
          <i class="fas fa-bolt"></i> Quick Actions
        </h2>
        <div class="action-grid">
          <a href="admin-registrationlist.html" class="action-card">
            <i class="fas fa-users"></i>
            <span>View Registrations</span>
          </a>
          <a href="admin-events.html" class="action-card">
            <i class="fas fa-calendar-plus"></i>
            <span>Create Event</span>
          </a>
          <a href="image_upload.html" class="action-card">
            <i class="fas fa-upload"></i>
            <span>Upload Images</span>
          </a>
          <a href="admin-video.html" class="action-card">
            <i class="fas fa-file-export"></i>
            <span>Upload Video</span>
          </a>
        </div>
      </div>
    </main>
  </div>

  <script>
    // Check for JWT token on page load
    document.addEventListener("DOMContentLoaded", () => {
      const token = localStorage.getItem("jwt");
      
      if (!token) {
        alert("You must login first.");
        window.location.href = "login.html";
        return;
      }
      
      // Mobile menu toggle
      const mobileMenuBtn = document.getElementById('mobileMenuBtn');
      const sidebar = document.getElementById('sidebar');
      const sidebarOverlay = document.getElementById('sidebarOverlay');
      
      mobileMenuBtn.addEventListener('click', () => {
        sidebar.classList.toggle('active');
        sidebarOverlay.classList.toggle('active');
      });
      
      sidebarOverlay.addEventListener('click', () => {
        sidebar.classList.remove('active');
        sidebarOverlay.classList.remove('active');
      });
      
      // Load dashboard data
      loadDashboardData();
    });

    async function loadDashboardData() {
      try {
        // Here you would make API calls to get real data
        // For now we're using mock data
        console.log("Loading dashboard data...");
        
        // Simulate API delay
        setTimeout(() => {
          console.log("Dashboard data loaded");
        }, 1000);
      } catch (error) {
        console.error("Error loading dashboard data:", error);
      }
    }

    function logout() {
      localStorage.removeItem('jwt');
      window.location.href = 'login.html';
    }

    // Call this on page load
function loadLoggedInUserInfo() {
  fetch('http://localhost:8080/api/user/me', {
    headers: {
      'Authorization': 'Bearer ' + localStorage.getItem('jwt')
    }
  })
  .then(response => response.json())
  .then(user => {
const role = (user.role === 'SECOND_ADMIN' || user.role === 'ADMIN') ? 'Admin' : 'User';

    document.getElementById('userAvatar').src =
      `https://ui-avatars.com/api/?name=${role}&background=4361ee&color=fff`;
    document.getElementById('userRoleDisplay').textContent = role;
  })
  .catch(error => {
    console.error("Failed to load user info:", error);
  });
}

loadLoggedInUserInfo(); // Call it when page loads

  </script>
</body>
</html>